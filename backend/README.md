# Rahhalah Backend API

Backend API ูุญููู ูุขูู ููููุน ุฑุญุงูู ููุชุฌุงุฑุฉ ุงูุฅููุชุฑูููุฉ.

## ๐ ูููู ุงููุดุฑูุน

```
backend/
โโโ config/
โ   โโโ db.js                    # ุฅุนุฏุงุฏุงุช ูุงุนุฏุฉ ุงูุจูุงูุงุช
โโโ models/
โ   โโโ Admin.js                 # ูููุฐุฌ ุงูุฃุฏูู
โ   โโโ Collection.js            # ูููุฐุฌ ุงููุฌููุนุงุช
โ   โโโ Product.js               # ูููุฐุฌ ุงูููุชุฌุงุช
โ   โโโ Order.js                 # ูููุฐุฌ ุงูุทูุจุงุช
โโโ controllers/
โ   โโโ admin.controller.js      # ููุทู ุงูุฃุฏูู
โ   โโโ collection.controller.js # ููุทู ุงููุฌููุนุงุช
โ   โโโ product.controller.js    # ููุทู ุงูููุชุฌุงุช
โ   โโโ order.controller.js      # ููุทู ุงูุทูุจุงุช
โโโ routes/
โ   โโโ admin.routes.js          # ูุณุงุฑุงุช ุงูุฃุฏูู
โ   โโโ collection.routes.js     # ูุณุงุฑุงุช ุงููุฌููุนุงุช
โ   โโโ product.routes.js        # ูุณุงุฑุงุช ุงูููุชุฌุงุช
โ   โโโ order.routes.js          # ูุณุงุฑุงุช ุงูุทูุจุงุช
โโโ middleware/
โ   โโโ auth.middleware.js       # ุงูุชุญูู ูู JWT
โ   โโโ validation.middleware.js # ุงูุชุญูู ูู ุงููุฏุฎูุงุช
โ   โโโ errorHandler.middleware.js # ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก
โโโ utils/
โ   โโโ pdfGenerator.js          # ุชูููุฏ ูููุงุช PDF
โโโ server.js                    # ููุทุฉ ุงูุฏุฎูู ุงูุฑุฆูุณูุฉ
โโโ package.json
โโโ .env
```

## ๐ ุงูููุฒุงุช ุงูุฃูููุฉ

### 1. **Helmet** - ุญูุงูุฉ Headers
- ุชุนููู HTTP headers ุขููุฉ
- Content Security Policy
- ุญูุงูุฉ ูู XSS attacks

### 2. **Rate Limiting** - ููุน ุงููุฌูุงุช
- 100 ุทูุจ ูุญุฏ ุฃูุตู ูู 15 ุฏูููุฉ
- 5 ูุญุงููุงุช ุชุณุฌูู ุฏุฎูู ููุท ูู 15 ุฏูููุฉ
- ุญูุงูุฉ ูู Brute Force attacks

### 3. **CORS** - ุงูุชุญูู ูู ุงููุตูู
- ุงูุณูุงุญ ููุท ููู Frontend ุงููุญุฏุฏ
- ููุน Cross-Origin attacks

### 4. **Input Sanitization** - ุชูุธูู ุงููุฏุฎูุงุช
- MongoDB Sanitization (ููุน NoSQL Injection)
- ุฅุฒุงูุฉ ุงูุฃุญุฑู ุงูุฎุทุฑุฉ ($, .)
- Express Validator

### 5. **JWT Authentication** - ุงููุตุงุฏูุฉ ุงูุขููุฉ
- Tokens ูุดูุฑุฉ
- HttpOnly Cookies
- Secure ูู Production
- ุงูุชูุงุก ุตูุงุญูุฉ ุจุนุฏ 7 ุฃูุงู

### 6. **Password Security** - ุญูุงูุฉ ูููุงุช ุงููุฑูุฑ
- Bcrypt hashing (12 rounds)
- ูุง ูุชู ุฅุฑุฌุงุน ูููุฉ ุงููุฑูุฑ ูู API
- ุงูุชุญูู ุงูุขูู ูู ูููุงุช ุงููุฑูุฑ

### 7. **Data Validation** - ุงูุชุญูู ูู ุงูุจูุงูุงุช
- Express Validator ููู Route
- Mongoose Schema Validation
- ุงูุชุญูู ูู ุฃุฑูุงู ุงูููุงุชู ุงููุตุฑูุฉ
- ุงูุชุญูู ูู URLs ููุตูุฑ

### 8. **Error Handling** - ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก
- Global error handler
- ูุนุงูุฌุฉ ุฎุงุตุฉ ููู ููุน ุฎุทุฃ
- ุนุฏู ูุดู ูุนูููุงุช ุญุณุงุณุฉ

### 9. **Stock Management** - ุฅุฏุงุฑุฉ ุงููุฎุฒูู
- ููุน ุงูุทูุจุงุช ุนูุฏ ููุงุฐ ุงููุฎุฒูู
- ุชุญุฏูุซ ุชููุงุฆู ูููุฎุฒูู
- ุญุณุงุจ ุฏููู ููุฃุณุนุงุฑ

### 10. **Request Tracking** - ุชุชุจุน ุงูุทูุจุงุช
- ุญูุธ IP Address
- ุญูุธ User Agent
- ููุชุญููู ูู ุญุงูุฉ ุงูุงุญุชูุงู

## ๐ ุงูุชุซุจูุช ูุงูุชุดุบูู

### ุงููุชุทูุจุงุช:
- Node.js v14+
- MongoDB v4.4+

### ุฎุทูุงุช ุงูุชุซุจูุช:

```bash
# 1. ุชุซุจูุช ุงูุญุฒู
npm install

# 2. ูุณุฎ ููู ุงูุจูุฆุฉ
cp .env.example .env

# 3. ุชุนุฏูู ููู .env ุจุฅุนุฏุงุฏุงุชู

# 4. ุชุฃูุฏ ูู ุชุดุบูู MongoDB

# 5. ุชุดุบูู ุงูุณูุฑูุฑ
npm start

# ุฃู ููุชุทููุฑ (ูุน auto-reload)
npm run dev
```

## ๐ก API Endpoints

### Admin Routes (`/api/admin`)
| Method | Endpoint | Access | Description |
|--------|----------|--------|-------------|
| POST | `/login` | Public | ุชุณุฌูู ุฏุฎูู ุงูุฃุฏูู |
| POST | `/logout` | Private | ุชุณุฌูู ุฎุฑูุฌ |
| GET | `/check` | Private | ุงูุชุญูู ูู ุงูุฌูุณุฉ |
| PUT | `/change-password` | Private | ุชุบููุฑ ูููุฉ ุงููุฑูุฑ |

### Collections (`/api/collections`)
| Method | Endpoint | Access | Description |
|--------|----------|--------|-------------|
| GET | `/` | Public | ุฌูุจ ุฌููุน ุงููุฌููุนุงุช |
| GET | `/:id` | Public | ุฌูุจ ูุฌููุนุฉ ูุงุญุฏุฉ |
| POST | `/` | Private | ุฅูุดุงุก ูุฌููุนุฉ |
| PUT | `/:id` | Private | ุชุญุฏูุซ ูุฌููุนุฉ |
| DELETE | `/:id` | Private | ุญุฐู ูุฌููุนุฉ |

### Products (`/api/products`)
| Method | Endpoint | Access | Description |
|--------|----------|--------|-------------|
| GET | `/` | Public | ุฌูุจ ุงูููุชุฌุงุช (ูุน filters) |
| GET | `/:id` | Public | ุฌูุจ ููุชุฌ ูุงุญุฏ |
| POST | `/` | Private | ุฅูุดุงุก ููุชุฌ |
| PUT | `/:id` | Private | ุชุญุฏูุซ ููุชุฌ |
| DELETE | `/:id` | Private | ุญุฐู ููุชุฌ |

### Orders (`/api/orders`)
| Method | Endpoint | Access | Description |
|--------|----------|--------|-------------|
| GET | `/` | Private | ุฌูุจ ุฌููุน ุงูุทูุจุงุช |
| GET | `/:id` | Private | ุฌูุจ ุทูุจ ูุงุญุฏ |
| POST | `/` | Public | ุฅูุดุงุก ุทูุจ ุฌุฏูุฏ |
| PUT | `/:id/status` | Private | ุชุญุฏูุซ ุญุงูุฉ ุงูุทูุจ |
| GET | `/:id/pdf` | Private | ุชุญููู ูุตู PDF |
| POST | `/calculate-shipping` | Public | ุญุณุงุจ ุชูููุฉ ุงูุดุญู |
| DELETE | `/:id` | Private | ุญุฐู ุทูุจ |

## ๐ ูุซุงู ุนูู ุงูุงุณุชุฎุฏุงู

### ุชุณุฌูู ุฏุฎูู ุงูุฃุฏูู
```javascript
POST /api/admin/login
Content-Type: application/json

{
  "email": "admin@rahhalah.com",
  "password": "admin123"
}
```

### ุฅูุดุงุก ููุชุฌ (ูุชุทูุจ authentication)
```javascript
POST /api/products
Authorization: Bearer <token>
Content-Type: application/json

{
  "title": "ููุฏู ุฃุณูุฏ",
  "description": "ููุฏู ูุทู ุนุงูู ุงูุฌูุฏุฉ",
  "collection": "64abc123...",
  "price": 350,
  "images": [
    "https://imgur.com/abc123.jpg",
    "https://imgur.com/def456.jpg"
  ],
  "sizes": ["S", "M", "L", "XL"],
  "colors": ["ุฃุณูุฏ", "ุฑูุงุฏู"]
}
```

### ุฅูุดุงุก ุทูุจ
```javascript
POST /api/orders
Content-Type: application/json

{
  "customerName": "ูุญูุฏ ุฃุญูุฏ",
  "phone": "01012345678",
  "address": "15 ุดุงุฑุน ุงููููุ ุงููุนุงุฏู",
  "governorate": "ุงููุงูุฑุฉ",
  "items": [
    {
      "product": "64abc123...",
      "quantity": 2,
      "size": "L",
      "color": "ุฃุณูุฏ"
    }
  ],
  "paymentMethod": "cash-on-delivery"
}
```

## โ๏ธ ููุงุญุธุงุช ุฃูููุฉ ูููุฉ

1. **ุบููุฑ JWT_SECRET** ูู production ุฅูู ูููุฉ ุนุดูุงุฆูุฉ ูููุฉ (32+ ุญุฑู)
2. **ุบููุฑ ุจูุงูุงุช ุงูุฃุฏูู** ุงูุงูุชุฑุงุถูุฉ ููุฑุงู
3. **ุงุณุชุฎุฏู HTTPS** ูู production
4. **ูุนูู MongoDB authentication** ูู production
5. **ุฑุงุฌุน Logs** ุจุงูุชุธุงู ูููุดู ุนู ูุญุงููุงุช ุงุฎุชุฑุงู
6. **ูููุฏ CORS** ููู domains ุงููุตุฑุญ ุจูุง ููุท
7. **ุงุณุชุฎุฏู Environment Variables** ูุฌููุน ุงูุจูุงูุงุช ุงูุญุณุงุณุฉ

## ๐ Validation Rules

### ุฃุฑูุงู ุงูููุงุชู ุงููุตุฑูุฉ
- ุชูุณูู: `01[0-2,5][0-9]{8}`
- ูุซุงู: `01012345678`

### ุงููุญุงูุธุงุช ุงููุณููุญุฉ
- ุงููุงูุฑุฉ (60 ุฌููู)
- ุงูุฌูุฒุฉ (65 ุฌููู)
- ุงููุงูุฑุฉ ุงูุฌุฏูุฏุฉ (70 ุฌููู)
- ุงูุฅุณููุฏุฑูุฉ (75 ุฌููู)
- ุงูุฏูุชุง (75 ุฌููู)
- ุงูุตุนูุฏ (85 ุฌููู)

### ุญุงูุงุช ุงูุทูุจ
- `pending` - ููุฏ ุงูุงูุชุธุงุฑ
- `confirmed` - ูุคูุฏ
- `shipped` - ุชู ุงูุดุญู
- `delivered` - ุชู ุงูุชูุตูู
- `cancelled` - ููุบู

### ุทุฑู ุงูุฏูุน
- `vodafone-cash` - ููุฏุงููู ูุงุด
- `cash-on-delivery` - ุงูุฏูุน ุนูุฏ ุงูุงุณุชูุงู

## ๐ ุงูุชุนุงูู ูุน ุงูุฃุฎุทุงุก

ุฌููุน ุงูุฃุฎุทุงุก ุชูุฑุฌุน ุจุงูุชูุณูู:

```json
{
  "success": false,
  "message": "ูุตู ุงูุฎุทุฃ",
  "errors": [] // ุฅู ููุฌุฏุช
}
```

Response Codes:
- `200` - ูุฌุญ ุงูุทูุจ
- `201` - ุชู ุงูุฅูุดุงุก
- `400` - ุฎุทุฃ ูู ุงูุจูุงูุงุช ุงููุฑุณูุฉ
- `401` - ุบูุฑ ูุตุฑุญ
- `403` - ููููุน
- `404` - ุบูุฑ ููุฌูุฏ
- `429` - Too Many Requests
- `500` - ุฎุทุฃ ูู ุงูุณูุฑูุฑ

## ๐ ุงูุชุฑุฎูุต

ูุฐุง ุงููุดุฑูุน ุฎุงุต ุจุจุฑุงูุฏ ุฑุญุงูู.

---

**ุตููุน ุจู โค๏ธ ูุน ุฃุนูู ูุนุงููุฑ ุงูุฃูุงู**
